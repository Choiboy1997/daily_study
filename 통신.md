# 20230518 통신

- 포트 넘버를 미리 정해서 server 내의 저장 공간을 미리 알 수 있게 해 놓았다.
이를 Well-known port number라고 한다.
- 포트는 전송계층에서 정한다.
- 포트넘버 만든 이유: IP하나로 여러 서비스를 이용할 수 있게 한다.
- 0번은 쓰면 안되고 1부터 1023번 포트까지는 미리 정해져 있다.
사용자가 서버에 요청할 때 자신이 받아올 데이터의 순서를 정하기 위하여 IP주소 뒤에 포트 넘버를 적는다.
- TCP: 사용자가 SYN으로 첫 요청, 받을때 SYN과 ACK 받음, 사용자는 확인했음을 뜻하는 ACK 다시 전송해야 한다
마지막 ACK를 전송하지 않을 시 서버측에서 사용자의 ACK를 계속 기다리고 있게 된다. 서버측의 메모리 부족 현상이 생김 이를 DOS 공격 이라고 함  여러 대의 PC로 공격할 시 DDOS공격이 됨 이를 해결하기 위해 connection에 타이머 설정
- 

4-way handshake는 TCP 연결을 종료하기 위해 수행되는 절차입니다. [이 절차는 클라이언트와 서버 간에 4개의 메시지를 교환하여 이루어집니다 **1**](https://mindnet.tistory.com/entry/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-22%ED%8E%B8-TCP-3-WayHandshake-4-WayHandshake).

1. 클라이언트가 연결을 종료하겠다는 FIN 플래그를 전송합니다.
2. 서버는 일단 확인 메시지를 보내고 자신의 통신이 끝날 때까지 기다립니다.
3. 서버가 통신이 끝났으면 연결이 종료되었다고 클라이언트에게 FIN 플래그를 전송합니다.
4. 클라이언트는 확인했다는 메시지를 보냅니다.

- TCP의 속도를 높이기 위해서 Window Size 조정을 할 수 있다.
- IP도 Best-Effort Delivery이다 신뢰성을 보장할 수없음
- IP MTU: 한번에 최대로 보낼 수 있는 양
- Jumbo Frame을 사용하면 프레임의 크기를 최대 9000바이트까지 늘릴 수 있다.
- window TTL은 128 혹은 64이고 리눅스는 255이다.
- UTP-1 일 때 1은 UTP 케이블의 종류를 난타낸다
- Half -duplex: 한쪽이 보낼 때 다른 쪽은 보낼 수 없다.
- Full-duplex: 양쪽이 동시에 보낼 수 있다.
- Sinplex: 한쪽만 보낼 수 있다.
- UTP cable의 연결 방식에 따라 straight cable과 cross cable로 나뉜다
- 컴퓨터 → 스위치 일 때 스위치가 rx 위치를 바꿔 놓기 때문에 straight 쓰면 된다.
- 스위치 → 스위치 일 때는 cross를 써야 한다.
- Auto-Mdix(media ==  cable) 기능이 있는 스위치는 오는 신호를 파악하여 자동으로 바꿔준다.
- Mac address 를 쓰는 이유: 멀티플한 환경에서 효율이 매우 좋다.
- Mac adress는 48bit로 이루어져 있고 앞의 22bit는 사서 써야 한다.
- TCP 통신의 처음엔 three-way handshake를 먼저 해야 한다.
- Mac adress를 알아낸 후 하는 통신 방법이 UNI캐스트이다. 1:1 통신 방법
- BroadCast: 모두에게 알리는 것 한 네트워크에서만 돌아다닐 수 있다. 절대 라우터를 벗어날 수 없음
- Multicast: 듣고 싶은 기기만 듣게 하는 것
- 인터넷 상은 UNI캐스트이다.

- TCP는 Transmission Control Protocol의 약자이다
- 가상의 통로, 연결을 구축하는 층은 전송계층이다 이 계층에서 사용되는 프로토콜이 TCP, UDP이다
- IPv4는 고갈이 예상된다. 이를 막기 위해 네트워크 주소 변환, CIDR등의 기술을 창출했다.
- IPv4 헤더의 크기는 최소 20바이트이고 최대 60바이트이다.

IPv4 헤더는 다음과 같은 필드로 구성됩니다:

- **버전 (Version)**: IP 프로토콜의 버전을 나타냅니다. IPv4의 경우 이 값은 항상 4입니다.
- **인터넷 헤더 길이 (IHL)**: IPv4 헤더의 길이를 32비트 워드 단위로 나타냅니다. 이 필드의 최소값은 5이며 최대값은 15입니다.
- **서비스 유형 (Type of Service)**: 패킷의 처리 방법을 지정합니다. 예를 들어, 패킷의 우선 순위, 지연, 처리량 등을 지정할 수 있습니다.
- **전체 길이 (Total Length)**: 전체 IP 패킷의 길이를 바이트 단위로 나타냅니다. 이 필드의 최대값은 65535입니다.
- **식별자 (Identification)**: IP 패킷을 식별하는 데 사용되는 값입니다. 이 필드는 IP 패킷이 조각화되었을 때 각 조각을 다시 조립하는 데 사용됩니다.
- **플래그 (Flags)**: IP 패킷의 조각화와 관련된 정보를 포함합니다. 예를 들어, 이 필드에는 “더 이상 조각화하지 않음” 플래그와 “더 많은 조각” 플래그가 있습니다.
- **조각 오프셋 (Fragment Offset)**: IP 패킷이 조각화되었을 때 각 조각의 위치를 나타냅니다.
- **TTL (Time To Live)**: IP 패킷이 네트워크에서 존재할 수 있는 최대 시간을 나타냅니다. 이 필드의 값이 0이 되면 IP 패킷은 폐기됩니다.
- **프로토콜 (Protocol)**: 상위 계층 프로토콜을 나타냅니다. 예를 들어, TCP의 경우 이 값은 6이고, UDP의 경우 이 값은 17입니다.
- **헤더 체크섬 (Header Checksum)**: IPv4 헤더의 오류 검사를 위한 값입니다. 수신 측에서는 이 값을 사용하여 IPv4 헤더에 오류가 있는지 확인합니다.
- **출발지 주소 (Source Address)**: IP 패킷의 출발지 주소입니다.
- **목적지 주소 (Destination Address)**: IP 패킷의 목적지 주소입니다.
- **옵션 (Options)**: 추가적인 정보를 포함하는 선택적인 필드입니다. 이 필드는 사용하지 않을 수도 있습니다.

- 헤더 체크섬은 IPv4 헤더의 모든 필드의 값을 더한 후 1의 보수를 취하여 계산된다. 이 때 각 값은 4바이트 단위로 계산된다.
- 포트 번호는 프레임의 전송 계층 헤더에 위치한다.
- 이더넷 프레임의 최대 길이가 1518byte이지만 표준에 따라 다르다.
- IP 패킷의 최대 길이는 65535byte
- 전송하려는 데이터가 65535byte보다 큰 경우 데이터를 여러 개의 IP 패킷으로 나누는 세그먼테이션을 실시한다.
- IP 패킷이 이더넷 프레임보다 클 경우 패킷을 fragmenetation(조각화)하여 송신한다.
- 데이터 -(세그먼테이션)> IP 패킷 -(조각화)>프레임
